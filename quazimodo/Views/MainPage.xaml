<?xml version="1.0" encoding="utf-8"?>

<ContentPage
    xmlns="http://xamarin.com/schemas/2014/forms"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:quazimodo="clr-namespace:quazimodo.Controlls;assembly=quazimodo"
    xmlns:enums="clr-namespace:quazimodo.Enums;assembly=quazimodo"
    xmlns:constants="clr-namespace:quazimodo.Constants;assembly=quazimodo"
    xmlns:viewModels="clr-namespace:quazimodo.ViewModels;assembly=quazimodo"
    xmlns:models="clr-namespace:quazimodo.Models;assembly=quazimodo"
    xmlns:resources="clr-namespace:quazimodo.Resources;assembly=quazimodo"
    NavigationPage.HasNavigationBar="False"
    BackgroundColor="{StaticResource darkPurple}"
    x:Class="quazimodo.Views.MainPage">
    <ContentPage.BindingContext>
        <viewModels:MainViewModel />
    </ContentPage.BindingContext>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="100" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ScrollView Grid.RowSpan="2">
            <StackLayout Spacing="0"
                         Margin="0,5,0,0">
                <!-- positive -->
                <Grid Margin="{StaticResource defaultOffset}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <BoxView Grid.RowSpan="2"
                             CornerRadius="{StaticResource defaultOffset}"
                             BackgroundColor="{StaticResource white6}" />
                    <Frame Grid.Row="0"
                           HorizontalOptions="CenterAndExpand"
                           VerticalOptions="Start">
                        <Label Style="{StaticResource soundCategoryStyle}"
                               TextColor="{StaticResource lightOrange}"
                               FontFamily="{StaticResource icomoonFont}"
                               Text="{x:Static resources:Localization.PositiveHeader}"/>
                    </Frame>
                    <quazimodo:SmileButtonsFlexLayout Grid.Row="1"
                                                      ItemSource="{Binding PositiveSoundList}" 
                                                      ItemStyle="{StaticResource positiveEmojiItem}"
                                                      Style="{StaticResource flexLayoutStyle}"/>
                </Grid>

                <Grid Margin="{StaticResource defaultOffset}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <BoxView Grid.RowSpan="2"
                             CornerRadius="{StaticResource defaultOffset}"
                             BackgroundColor="{StaticResource white4}" />
                    <Frame Grid.Row="0"
                           HorizontalOptions="CenterAndExpand"
                           VerticalOptions="Start">
                        <Label Style="{StaticResource soundCategoryStyle}"
                               TextColor="{StaticResource lightGray}"
                               Text="{x:Static resources:Localization.NeutralHeader}" />
                    </Frame>
                    <quazimodo:SmileButtonsFlexLayout Grid.Row="1"
                                                      ItemSource="{Binding NeutralSoundList}" 
                                                      ItemStyle="{StaticResource neutralEmojiItem}"
                                                      Style="{StaticResource flexLayoutStyle}"/>
                </Grid>

                <!-- negative -->
                <Grid Margin="{StaticResource defaultOffset}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <BoxView Grid.RowSpan="2"
                             CornerRadius="{StaticResource defaultOffset}"
                             BackgroundColor="{StaticResource white5}" />
                    <Frame Grid.Row="0"
                           HorizontalOptions="CenterAndExpand"
                           VerticalOptions="Start">
                        <Label Style="{StaticResource soundCategoryStyle}"
                               TextColor="{StaticResource lightYellow}"
                               Text="{x:Static resources:Localization.NegativeHeader}" />
                    </Frame>
                    <quazimodo:SmileButtonsFlexLayout Grid.Row="1"
                                                      ItemSource="{Binding NegativeSoundList}" 
                                                      ItemStyle="{StaticResource negativeEmojiItem}"
                                                      Style="{StaticResource flexLayoutStyle}">
                    </quazimodo:SmileButtonsFlexLayout>
                </Grid>

                <StackLayout Orientation="Horizontal"
                             HorizontalOptions="Center"
                             Margin="{StaticResource defaultOffset}">
                    <ImageButton Source="{x:Static constants:ImageIdConstants.Reject}"
                                 Style="{StaticResource acceptButtonStyle}"
                                 CommandParameter="{x:Static enums:SoundParameter.Reject}" />
                    <Button Text="{x:Static resources:Localization.Tap}"
                            BackgroundColor="{StaticResource white4}"
                            CornerRadius="{StaticResource defaultCorner}"
                            Command="{Binding MyAppsCommand}"
                            IsVisible="{Binding MyAppsIsExist}" />
                    <Button Text="Rec"
                            BackgroundColor="{StaticResource white4}"
                            CornerRadius="{StaticResource defaultCorner}"
                            Command="{Binding RecordCommand}"/>
                    <ImageButton Source="{x:Static constants:ImageIdConstants.Accept}"
                                 Style="{StaticResource acceptButtonStyle}"
                                 CommandParameter="{x:Static enums:SoundParameter.Accept}" />
                </StackLayout>
            </StackLayout>
        </ScrollView>

        <ImageButton Grid.Row="1"
                     HorizontalOptions="Center"
                     BackgroundColor="{StaticResource darkPurple}"
                     VerticalOptions="End"
                     HeightRequest="80"
                     WidthRequest="80"
                     CornerRadius="20"
                     Aspect="AspectFit"
                     IsVisible="{Binding StopButtonVisible}"
                     Command="{Binding StopCommand}"
                     Source="{x:Static constants:ImageIdConstants.Stop}"
                     Padding="10"
                     Margin="0,0,0,20" />

        <Grid Grid.Row="0"
              Grid.RowSpan="2"
              Margin="20,0,20,0"
              BackgroundColor="{StaticResource darkPurple}"
              Opacity="0.8"
              IsVisible="{Binding DonationPageVisible}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <ScrollView Grid.Row="1">
                <Frame BorderColor="Beige"
                       BackgroundColor="Transparent">
                    <StackLayout>
                        <Label TextColor="Beige"
                               Margin="0,0,0,20"
                               FontSize="22"
                               Text="{x:Static resources:Localization.AdMessageHeader}"/>
                        <Label TextColor="Beige"
                               FontSize="16"
                               Text="{x:Static resources:Localization.AdMessage}"/>
                    </StackLayout>
                </Frame>
            </ScrollView>
            
            <Button Grid.Row="0"
                    Text="{x:Static resources:Localization.Skip}"
                    VerticalOptions="End"
                    Margin="0,40,0,0"
                    BackgroundColor="{StaticResource darkPurple}"
                    TextColor="Beige"
                    BorderColor="Beige"
                    BorderWidth="1"
                    Command="{Binding HidePopupCommand}" />
            <Button Grid.Row="2"
                    Text="{x:Static resources:Localization.Stop}"
                    VerticalOptions="End"
                    BackgroundColor="#303030"
                    TextColor="Beige"
                    BorderColor="Beige"
                    BorderWidth="1"
                    IsVisible="{Binding StopButtonVisible}"
                    Command="{Binding StopCommand}" />
        </Grid>

        <Grid Grid.Row="0"
              Grid.RowSpan="2"
              Margin="20,0,20,0"
              BackgroundColor="{StaticResource darkPurple}"
              Opacity="0.8"
              IsVisible="{Binding MyAppsPageVisible}">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Frame Grid.Row="0"
                   BorderColor="Beige"
                   BackgroundColor="Transparent">
                <CollectionView x:Name="collectionView"
                                ItemsSource="{Binding MyApps}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:MyApp">
                            <Grid Padding="0,0,0,20">
                                <Frame BorderColor="Beige"
                                       BackgroundColor="Transparent">
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer
                                            Command="{Binding Source={x:Reference collectionView}, 
                                        Path=BindingContext.SelectedMyAppCommand}"
                                            CommandParameter="{Binding DownloadUrl}" />
                                    </Frame.GestureRecognizers>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Image Grid.Row="0"
                                               Grid.RowSpan="2"
                                               Grid.Column="0"
                                               HeightRequest="60"
                                               WidthRequest="60"
                                               HorizontalOptions="Start"
                                               VerticalOptions="Start"
                                               Source="{Binding ImageUrl}" />
                                        <Label Grid.Row="0"
                                               Grid.Column="1"
                                               HorizontalOptions="Start"
                                               HorizontalTextAlignment="Start"
                                               Margin="10,0,0,0"
                                               TextColor="Beige"
                                               Text="{Binding Name}" />
                                        <Label Grid.Row="1"
                                               Grid.Column="1"
                                               Margin="10,0,0,0"
                                               TextColor="Beige"
                                               Text="{Binding Description}" />
                                    </Grid>
                                </Frame>
                            </Grid>

                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Frame>

            <Button Grid.Row="1"
                    Text="{x:Static resources:Localization.Hide}"
                    VerticalOptions="End"
                    BackgroundColor="{StaticResource darkPurple}"
                    TextColor="Beige"
                    BorderColor="Beige"
                    BorderWidth="1"
                    Command="{Binding HideMyAppsCommand}" />
        </Grid>

        <quazimodo:AdMobBannerView x:Name="adMobBannerView"
                                   Grid.Row="2"
                                   AdId="{x:Static constants:AdConstants.TestBannerId}" />
    </Grid>
</ContentPage>